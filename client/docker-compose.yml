version: '3.8'

services:
  tahyamisr-frontend:
    container_name: TahyaMisrFront
    build:
      context: ./TahyaMisr/Frontend  # Adjust path as needed
      dockerfile: Dockerfile
    ports:
      - "3000:5173"  # Map host port 3000 to container port 5173
    environment:
      - NODE_ENV=production
      - PORT=5173
      - SITE_URL=https://tahyamisryu.com  # Update with your domain
      # Add other environment variables as needed
      # - SITEMAP_WEBHOOK_URL=https://your-cms.com/api/webhooks/sitemap-updated
    volumes:
      # Optional: Mount sitemap volume for persistence
      - sitemap_data:/app/public
    restart: unless-stopped
    networks:
      - npm_internal
    healthcheck:
      test: ["CMD", "node", "-e", "const http = require('http'); const req = http.request({host: 'localhost', port: 5173, path: '/api/sitemap/status'}, (res) => process.exit(res.statusCode === 200 ? 0 : 1)); req.on('error', () => process.exit(1)); req.end();"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  sitemap_data:
    driver: local

networks:
  npm_internal:
    external: true